---
title: "Report"
author: "Keliang Xu, Shuting Li, Tao He"
date: "3/2/2022"
output:
  pdf_document: default
  html_document: default
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(ggplot2)
library(openxlsx)
library(reshape2)
library(dplyr)
library(tidyr)
library(formattable)
library(stats)
library(qqplotr)
```

# 1 Abstract

&nbsp; &nbsp; Since isotopes can enter animals' bones by eating, through the comparisons of average levels of carbon and nitrogen isotopes from ancient animals' bones in two sites of ancient Mexico, we can conclude about whether animals from two sites of ancient Mexico had similar diets. After we cleaned our data set, we summary it and do some exploratory data analysis to see the distribution of the isotope levels. Moreover, we use two-sample t-tests and Mann-Whitney U Test whether there exists significant difference in diets between BAOX and PATT. This report consists of 4 main sections: Introduction, EDA and Testing, Discussion, and Conclusion.


# 2 Introduction

## 2.1 Data Explanation

&nbsp; &nbsp; The variables of interest are "Taxa", "Site" and "Carbon and Nitrogen Level". 

&nbsp; &nbsp; The "Taxa" includes four types of animals, which are turkey, cottontails, deer, and hare. 

&nbsp; &nbsp; The “site” includes two sites, which are BAOX and PATT. 

&nbsp; &nbsp; The “Carbon and Nitrogen level” includes three stable carbon and nitrogen isotopes from two closely related sites (BAOX and PATT) from the same area and period. "d13C_VPDB", "ap_13C_VPDB" and "d15N_air". These isotopes can enter bones by eating and reflect the isotopic values of food sources. The first two carbon isotopes tell us about the level of human-grown plants in the diet, such as maize (corn). Carbon isotopes from collagen are protein-derived. Carbon isotopes from apatite (carbonate) reflect the whole diet. Nitrogen isotopes tell us about the protein in the diet.


## 2.2 Client’s Work

What our client has done:
  
&nbsp; &nbsp;1.) Used Mann Whitney U tests to test the differences between BAOX and PATT for each species.

&nbsp; &nbsp;2.) Examined box-plots and test just those groupings that look different.


## 2.3 Our Responsibility

&nbsp; &nbsp;1.) Check all client's works, including the summary data table and box plots.

&nbsp; &nbsp;2.) Use statistical methods to show there is no significant difference in specific animals’ diets from BAOX and PATT, except cottontails.


# 3 EDA and Testing

## 3.1 Data Cleaning 

```{r, include=FALSE}
#read data
data<-read.xlsx("for_stats_peeps.xlsx")
data<-data[,-2:-6]
data<-data[,-4]
removedata<-c("MC381","MC389","MC393","MC76")
#data <- na.omit(data)
i<-1
for(i in i:4) data<-subset(data,data$ID!=removedata[i])

```

```{r, include=FALSE}
#tidy data
data2<-data[,2:8]
data2<-data2[,-3]
data2<-data2[,-5]
aggdata<-melt(data2,id=(c("Taxa","Site")))

```
Dropped 4 missing value, their IDs are MC381,MC389,MC393,MC76.

## 3.2 EDA

+ Summary of Data:

&nbsp; &nbsp;The output is exactly same with client's work.
```{r,echo=FALSE,message=FALSE}
summ <- aggdata %>%                              
  group_by(Taxa,Site,variable) %>% 
  na.omit(aggdata) %>%
  summarize(min = min(value),
            median = median(value),
            mean = mean(value),
            max = max(value),
            sd = sd(value),
            count=n())
(summ)
```


```{r,echo=FALSE,include=FALSE,warning=FALSE}
ggplot(data = aggdata, aes(x=variable,y=value, fill=variable)) + 
  geom_boxplot()+
  geom_jitter(shape=16, position=position_jitter(0.2))+
  facet_wrap(~Taxa,nrow = 1)
```

&nbsp; &nbsp; In this plot, we compared specific isotopes level in 4 taxon. It showed the level of d15N_air is less diverse than other 2 isotopes.

```{r, echo=FALSE,warning=FALSE, fig.width = 7, fig.height=3}
ggplot(data = aggdata, aes(x=Taxa,y=value, fill=Taxa)) + 
  geom_boxplot()+
  geom_jitter(shape=16, position=position_jitter(0.2))+
  facet_wrap(~variable,nrow = 1)
```

Then we compared isotopes in two sites for each kind of animals. The plot shows that the median level of d13C_VPDB and d15N_air in BAOX is higher than Tlajinga of cottontail. Similarly, the median level of d13C_VPDB and d15N_air of hare also show difference in the boxplot.


```{r, echo=FALSE,warning=FALSE}
data_deer<-aggdata[which(aggdata$Taxa=="Deer"),]
data_Cottontail<-aggdata[which(aggdata$Taxa=="Cottontail"),]
data_Hare<-aggdata[which(aggdata$Taxa=="Hare"),]
data_Turkey<-aggdata[which(aggdata$Taxa=="Turkey"),]

deer1<-ggplot(data = data_deer, aes(x=variable,y=value, fill=variable)) + 
  geom_boxplot()+
  #geom_jitter(shape=16, position=position_jitter(0.2))+
  labs(title = 'Deer')+
  facet_wrap(~Site,nrow = 1)

deer2<-ggplot(data = data_deer, aes(x=Site,y=value, fill=Site)) + 
  geom_boxplot()+
  #geom_jitter(shape=16, position=position_jitter(0.2))+
  labs(title = 'Deer')+
  facet_wrap(~variable,nrow = 1)



cot1<-ggplot(data = data_Cottontail, aes(x=variable,y=value, fill=variable)) + 
  geom_boxplot()+
  #geom_jitter(shape=16, position=position_jitter(0.2))+
  labs(title = 'Cottontail')+
  facet_wrap(~Site,nrow = 1)

cot2<-ggplot(data = data_Cottontail, aes(x=Site,y=value, fill=Site)) + 
  geom_boxplot()+
  #geom_jitter(shape=16, position=position_jitter(0.2))+
  labs(title = 'Cottontail')+
  facet_wrap(~variable,nrow = 1)


hare1<-ggplot(data = data_Hare, aes(x=variable,y=value, fill=variable)) + 
  geom_boxplot()+
  #geom_jitter(shape=16, position=position_jitter(0.2))+
  labs(title = 'Hare')+
  facet_wrap(~Site,nrow = 1)

hare2<-ggplot(data = data_Hare, aes(x=Site,y=value, fill=Site)) + 
  geom_boxplot()+
  #geom_jitter(shape=16, position=position_jitter(0.2))+
  labs(title = 'Hare')+
  facet_wrap(~variable,nrow = 1)

turkey1<-ggplot(data = data_Turkey, aes(x=variable,y=value, fill=variable)) + 
  geom_boxplot()+
  #geom_jitter(shape=16, position=position_jitter(0.2))+
  labs(title = 'Turkey')+
  facet_wrap(~Site,nrow = 1)

turkey2<-ggplot(data = data_Turkey, aes(x=Site,y=value, fill=Site)) + 
  geom_boxplot()+
  #geom_jitter(shape=16, position=position_jitter(0.2))+
  labs(title = 'Turkey')+
  facet_wrap(~variable,nrow = 1)

```

```{r, echo=FALSE,warning=FALSE}

#gridExtra::grid.arrange(deer1,cot1,nrow=2,ncol=1)
#gridExtra::grid.arrange(hare1,turkey1,nrow=2,ncol=1)

gridExtra::grid.arrange(deer2,cot2,nrow=2,ncol=1)
gridExtra::grid.arrange(hare2,turkey2,nrow=2,ncol=1)

```

### Check Outlier

We found one outlier which is one of Cottontail d15N_air variable in BAOX. 
The outlier number is 13.6. The mean is 6.99. The sd is 2.86. 
13.6 falls outside of $[mean-2sd , mean+2sd]=[1.27,12.71]$, so we believe it is a outlier.

The selected data set is as follows:
  
```{r,echo=FALSE}
filter(aggdata,Taxa=="Cottontail" & Site=="BAOX" & variable=="d15N_air")$value
```

```{r,include=FALSE}
max(filter(aggdata,Taxa=="Cottontail" & Site=="BAOX" & variable=="d15N_air")$value)
mean(filter(aggdata,Taxa=="Cottontail" & Site=="BAOX" & variable=="d15N_air")$value)
sd(filter(aggdata,Taxa=="Cottontail" & Site=="BAOX" & variable=="d15N_air")$value)
```

According to client, we did not exclude this outlier from the data set. Therefore, all the data below include this outlier point.

## 3.2 Testing

### Two-Sample T-tests

&nbsp; &nbsp;After finding We plan to try some statistic test or some regression to compare the isotopes level in two sites more precisely. We would like to use the T-tests to find the difference of diets between two sites.

&nbsp; &nbsp;Firstly, we checked the normality.

```{r,echo=FALSE,warning=FALSE, include=FALSE}
# check the d13C_VPDB
aggdata1 <- filter(aggdata, variable== "d13C_VPDB" & Site == "BAOX")
ggplot1 <- ggplot(aggdata1, aes(value, colour = Taxa,fill=Taxa)) + geom_density(alpha = 0.3) +
  scale_fill_brewer(palette="Dark2") +
  scale_color_brewer(palette="Dark2") +
  labs(x = "d13C_VPDB", y = "density", title = '"d13C_VPDB level" distribution in BOAX')


aggdata2 <- filter(aggdata, variable== "d13C_VPDB" & Site == "Tlajinga")
ggplot2 <- ggplot(aggdata2, aes(value, colour = Taxa,fill=Taxa)) + geom_density(alpha = 0.3) +
  scale_fill_brewer(palette="Dark2") +
  scale_color_brewer(palette="Dark2") +
  labs(x = "d13C_VPDB", y = "density", title = '"d13C_VPDB level" distribution in Tlajinga')

# check the d15N_air
aggdata3 <- filter(aggdata, variable== "d15N_air" & Site == "BAOX")
ggplot3 <- ggplot(aggdata3, aes(value, colour = Taxa,fill=Taxa)) + geom_density(alpha = 0.3) +
  scale_fill_brewer(palette="Dark2") +
  scale_color_brewer(palette="Dark2") +
  labs(x = "d13C_VPDB", y = "density", title = '"d15N_air level" distribution in BOAX')


aggdata4 <- filter(aggdata, variable== "d15N_air" & Site == "Tlajinga")
ggplot4 <- ggplot(aggdata4, aes(value, colour = Taxa,fill=Taxa)) + geom_density(alpha = 0.3) +
  scale_fill_brewer(palette="Dark2") +
  scale_color_brewer(palette="Dark2") +
  labs(x = "d13C_VPDB", y = "density", title = '"d15N_air level" distribution in Tlajinga')

# check the ap_13C_VPDB
aggdata5 <- filter(aggdata, variable== "ap_13C_VPDB" & Site == "BAOX")
ggplot5 <- ggplot(aggdata5, aes(value, colour = Taxa,fill=Taxa)) + geom_density(alpha = 0.3) +
  scale_fill_brewer(palette="Dark2") +
  scale_color_brewer(palette="Dark2") +
  labs(x = "d13C_VPDB", y = "density", title = '"d15N_air level" distribution in BOAX')


aggdata6 <- filter(aggdata, variable== "ap_13C_VPDB" & Site == "Tlajinga")
ggplot6 <- ggplot(aggdata6, aes(value, colour = Taxa,fill=Taxa)) + geom_density(alpha = 0.3) +
  scale_fill_brewer(palette="Dark2") +
  scale_color_brewer(palette="Dark2") +
  labs(x = "d13C_VPDB", y = "density", title = '"ap_13C_VPDB level" distribution in Tlajinga')
```

```{r fig.height=6, fig.width= 8, warning=FALSE,echo=FALSE}
gridExtra::grid.arrange(ggplot1, ggplot2, ggplot3, ggplot4, ggplot5, ggplot6)
```

&nbsp; &nbsp; It is difficult to observe from the figures whether they follow the normal distribution, but comparing the distributions of the two places, most of them follow different distributions. It is reasonable since our sample size is too small.

&nbsp; &nbsp; Therefore, we also plot the Q-Q plots for checking the normality. The purpose of the quantile-quantile (QQ) plot is to show if two data sets come from the same distribution. Plotting the first data set's quantiles along the x-axis and plotting the second data set's quantiles along the y-axis is how the plot is constructed.

```{r,include=FALSE}
# data set
test.turkey.d13C <- filter(aggdata, Taxa == "Turkey" & variable== "d13C_VPDB")
test.Cottontail.d13C <- filter(aggdata, Taxa == "Cottontail" & variable== "d13C_VPDB")
test.Deer.d13C <- filter(aggdata, Taxa == "Deer" & variable== "d13C_VPDB")
test.Hare.d13C <- filter(aggdata, Taxa == "Hare" & variable== "d13C_VPDB")

test.turkey.d15N <- filter(aggdata, Taxa == "Turkey" & variable== "d15N_air")
test.Cottontail.d15N <- filter(aggdata, Taxa == "Cottontail" & variable== "d15N_air")
test.Deer.d15N <- filter(aggdata, Taxa == "Deer" & variable== "d15N_air")
test.Hare.d15N <- filter(aggdata, Taxa == "Hare" & variable== "d15N_air")

test.turkey.ap13C <- filter(aggdata, Taxa == "Turkey" & variable== "ap_13C_VPDB")
test.Cottontail.ap13C <- filter(aggdata, Taxa == "Cottontail" & variable== "ap_13C_VPDB")
test.Deer.ap13C <- filter(aggdata, Taxa == "Deer" & variable== "ap_13C_VPDB")
test.Hare.ap13C <- filter(aggdata, Taxa == "Hare" & variable== "ap_13C_VPDB")
```


```{r,echo=FALSE, include=FALSE}
# "d13C_VPDB" level in turkey groups
plot1 <- ggplot(test.turkey.d13C, aes(sample = value)) + 
  stat_qq_band() +
  stat_qq_point() + 
  stat_qq_line(col = "steelblue", lwd = 0.5) + 
  theme_bw() +
  xlab("Theortical Quantiles") +
  ylab("Sample Quantiles") +
  ggtitle('Normal Q-Q plot of "d13C_VPDB" level in turkey groups')

# "d13C_VPDB" level in Cottontail groups
plot2 <- ggplot(test.Cottontail.d13C, aes(sample = value)) + 
  stat_qq_band() +
  stat_qq_point() + 
  stat_qq_line(col = "steelblue", lwd = 0.5) + 
  theme_bw() +
  xlab("Theortical Quantiles") +
  ylab("Sample Quantiles") +
  ggtitle('Normal Q-Q plot of "d13C_VPDB" level in cottontail groups')

# "d13C_VPDB" level in Deer groups
plot3 <- ggplot(test.Deer.d13C, aes(sample = value)) + 
  stat_qq_band() +
  stat_qq_point() + 
  stat_qq_line(col = "steelblue", lwd = 0.5) + 
  theme_bw() +
  xlab("Theortical Quantiles") +
  ylab("Sample Quantiles") +
  ggtitle('Normal Q-Q plot of "d13C_VPDB" level in deer groups')

# "d13C_VPDB" level in Hare groups
plot4 <- ggplot(test.Hare.d13C, aes(sample = value)) + 
  stat_qq_band() +
  stat_qq_point() + 
  stat_qq_line(col = "steelblue", lwd = 0.5) + 
  theme_bw() +
  xlab("Theortical Quantiles") +
  ylab("Sample Quantiles") +
  ggtitle('Normal Q-Q plot of "d13C_VPDB" level in hare groups')

# "d15N_air" level in turkey groups
plot5 <- ggplot(test.turkey.d15N, aes(sample = value)) + 
  stat_qq_band() +
  stat_qq_point() + 
  stat_qq_line(col = "steelblue", lwd = 0.5) + 
  theme_bw() +
  xlab("Theortical Quantiles") +
  ylab("Sample Quantiles") +
  ggtitle('Normal Q-Q plot of "d15N_air" level in turkey groups')

# "d15N_air" level in Cottontail groups
plot6 <- ggplot(test.Cottontail.d15N, aes(sample = value)) + 
  stat_qq_band() +
  stat_qq_point() +
  stat_qq_line(col = "steelblue", lwd = 0.5) + 
  theme_bw() +
  xlab("Theortical Quantiles") +
  ylab("Sample Quantiles") +
  ggtitle('Normal Q-Q plot of "d15N_air" level in Cottontail groups')

# "d15N_air" level in Deer groups
plot7 <- ggplot(test.Deer.d15N, aes(sample = value)) + 
  stat_qq_band() +
  stat_qq_point() + 
  stat_qq_line(col = "steelblue", lwd = 0.5) + 
  theme_bw() +
  xlab("Theortical Quantiles") +
  ylab("Sample Quantiles") +
  ggtitle('Normal Q-Q plot of "d15N_air" level in Deer groups')

# "d15N_air" level in Hare groups
plot8 <- ggplot(test.Hare.d15N, aes(sample = value)) + 
  stat_qq_band() +
  stat_qq_point() + 
  stat_qq_line(col = "steelblue", lwd = 0.5) + 
  theme_bw() +
  xlab("Theortical Quantiles") +
  ylab("Sample Quantiles") +
  ggtitle('Normal Q-Q plot of "d15N_air" level in Hare groups')

# "ap_13C_VPDB" level in turkey groups
plot9 <- ggplot(test.turkey.ap13C, aes(sample = value)) + 
  stat_qq_band() +
  stat_qq_point() + 
  stat_qq_line(col = "steelblue", lwd = 0.5) + 
  theme_bw() +
  xlab("Theortical Quantiles") +
  ylab("Sample Quantiles") +
  ggtitle('Normal Q-Q plot of "ap_13C_VPDB" level in turkey groups')
  
# "ap_13C_VPDB" level in Cottontail groups
plot10 <- ggplot(test.Cottontail.ap13C, aes(sample = value)) + 
  stat_qq_band() +
  stat_qq_point() + 
  stat_qq_line(col = "steelblue", lwd = 0.5) + 
  theme_bw() +
  xlab("Theortical Quantiles") +
  ylab("Sample Quantiles") +
  ggtitle('Normal Q-Q plot of "ap_13C_VPDB" level in Cottontail groups')

# "ap_13C_VPDB" level in Deer groups
plot11 <- ggplot(test.Deer.ap13C, aes(sample = value)) + 
  stat_qq_band() +
  stat_qq_point() + 
  stat_qq_line(col = "steelblue", lwd = 0.5) + 
  theme_bw() +
  xlab("Theortical Quantiles") +
  ylab("Sample Quantiles") +
  ggtitle('Normal Q-Q plot of "ap_13C_VPDB" level in Deer groups')

# "ap_13C_VPDB" level in Hare groups
plot12 <- ggplot(test.Hare.ap13C, aes(sample = value)) + 
  stat_qq_band() +
  stat_qq_point() + 
  stat_qq_line(col = "steelblue", lwd = 0.5) + 
  theme_bw() +
  xlab("Theortical Quantiles") +
  ylab("Sample Quantiles") +
  ggtitle('Normal Q-Q plot of "ap_13C_VPDB" level in Hare groups')
```

```{r echo=FALSE, fig.height=20, fig.width= 17}
gridExtra::grid.arrange(plot1, plot2, plot3, plot4, plot5, plot6, 
                        plot7, plot8, plot9, plot10, plot11, plot12, 
                        nrow = 4, ncol = 3)
```

&nbsp; &nbsp; Expect "d15N_air" level in turkey groups, as almost all the points fall approximately along this reference line, we can assume normality to some extent.

&nbsp; &nbsp; After we checked the distribution of isotope levels for each animal in each space, the sample size is too small to identify if they follow normal distributions. We decided to do some shapiro.test.

&nbsp; &nbsp; Shapiro.test is a test of normality. If the p-value from the result is greater than the significance level (e.g. 0.05), we can assume the normality. Then, from the results of shapiro.test(), we can regard all groups have the normal distribution at 95% confidence interval.

&nbsp; &nbsp; Since we have four different species and three isotope levels, we are supposed to have till 12 tests, which will exist the multiple testing problem. Therefore, we calculate the proper significant level so that the probability of observing at least one significant result due to chance remains below we desired significance level. The final significant level we set is 0.01. Moreover, We assume the null hypothesis is the isotope level for each species between the two places are the same, while the alternative hypothesis is the isotope level for each species between the two places are not the same. 

&nbsp; &nbsp; At the 99% confidence interval, we can conclude that: all the isotope levels are the same between BAOX and PATT.



## Mann Whitney U Test

### Mann Whitney U Test with R Package

We found that description of R function wilcox.test from R package stats: Performs one- and two-sample Wilcoxon tests on vectors of data; the latter is also known as ‘Mann-Whitney’ test. That was exactly what we need now. And the same as T-test, we use 99% confidence level and same null hypothesis to test.

We can carefully look at these results. Since these p-values are not less than 0.01, we fail to reject the null hypothesis. 


### Check Mann-Whitney U Test with theory

We are concerned that small data size (about n=10) may affect the accuracy of the R package function. Therefore, we wrote a program to test the data in full accordance with the Mann-Whitney U Test theory with a significance level of .01. In the program, if the return value is True we can reject the null hypothesis, and if the return value is False, we fail to reject the null hypothesis.

Based on all return values being false, we fail to reject the null hypothesis. Since we failed to reject the null hypothesis, we do not have sufficient evidence to say that the "Carbon and Nitrogen Level" of each animals in two sites are different.


# 4 Discussion

&nbsp; &nbsp; When we checked the normality of the data set, we use the shapiro.test() to confirm the distribution of those isotope levels. However, the disadvantage of this method is we can not suppose the distribution of isotope level has not the significant difference with normal distribution at 95% confidence interval. We can not make sure that they are exactly following the normal distribution. Similarly, when we do the t-tests, we conclude that the isotope levels for each species are the same between the two close places. We still can not say they are the same at 100% level. We can only say that at 95% confidence interval, the diets between BAOX and PATT are the same. 

&nbsp; &nbsp; Actually, we firstly use the most common significant level with 0.05 to do the two-sample t-tests. However, the results show that there exists a significant one among the 12 tests. At first blush, this doesn’t seem like a bad outcome. However, consider a case where we have 12 hypotheses to test, and a significance level of 0.05. There exists the probability of observing at least one significant result just due to chance. 

$$\begin{aligned}
p(at \ least \ one \ significant \ result) &= 1 - (no \ significant \ results)\\ 
&= 1 - (1 - \alpha)^n\\
&= 1 - (1 - \alpha)^{12}\\
\end{aligned}$$

&nbsp; &nbsp; If we set the significant level with 0.05, $$\begin{aligned}
p(at \ least \ one \ significant \ result) &= 1 - (1 - 0.05)^{12}\\ 
&	\approx 0.46,\\
\end{aligned}$$
&nbsp; &nbsp; the probability of rejecting the null hypothesis by chance is 0.46, almost a half. Then, we decided to set the significant level with 0.01, $$\begin{aligned}
p(at \ least \ one \ significant \ result) &= 1 - (1 - 0.01)^{12}\\ 
&	\approx 0.11,\\
\end{aligned}$$
&nbsp; &nbsp; which significantly reduces chance to fail to reject the null hypothesis.



# 5 Conclusion

&nbsp; &nbsp; We checked all client's works, including the summary of data and box plots, our results are consistent with hers. Then, after we did two tests to statistically analyse the main problem we want to solve, we conclude that there were no significant differences in animals’ diets from BAOX and PATT.


# Citation
Andrew D. Somerville & Nawa Sugiyama & Linda R. Manzanilla & Margaret J. Schoeninger1,Leporid management and specialized food productionat Teotihuacan: stable isotope data from cottontail and jackrabbitbone collagen, 6 October, 2016


\newpage

# Appendix

## Test code 

Two-Sample T-tests are as followings:
  
### "d13C_VPDB" level
  
```{r}
# Assumption
# H0 : v1  = v2
# Ha : v1 != v2
```

```{r}
# "d13C_VPDB" level in turkey groups
with(test.turkey.d13C, shapiro.test(value[Site == "BAOX"])) # p = 0.4606
with(test.turkey.d13C, shapiro.test(value[Site == "Tlajinga"])) # p = 0.7027

# From the output, the two p-values are greater than the significance level 0.05 
# implying that the distribution of the data are not significantly different 
# from the normal distribution. In other words, we can assume the normality.

t.test(value ~ Site, data = test.turkey.d13C, conf.level = 0.99, var.equal = TRUE)
# p = 0.3323
# Not reject!
```


```{r}
# "d13C_VPDB" level in Cottontail groups
with(test.Cottontail.d13C, shapiro.test(value[Site == "BAOX"])) # p = 0.5969
with(test.Cottontail.d13C, shapiro.test(value[Site == "Tlajinga"])) # p = 0.3941

# From the output, the two p-values are greater than the significance level 0.05 
# implying that the distribution of the data are not significantly different 
# from the normal distribution. In other words, we can assume the normality.
t.test(value ~ Site, data = test.Cottontail.d13C, conf.level = 0.99, var.equal = TRUE)
# p = 0.8162
# Not reject!
```

```{r}
# "d13C_VPDB" level in Deer groups
with(test.Deer.d13C, shapiro.test(value[Site == "BAOX"])) # p = 0.3914
with(test.Deer.d13C, shapiro.test(value[Site == "Tlajinga"])) # p = 0.2177

# From the output, the two p-values are greater than the significance level 0.05 
# implying that the distribution of the data are not significantly different 
# from the normal distribution. In other words, we can assume the normality.
t.test(value ~ Site, data = test.Deer.d13C, conf.level = 0.99, var.equal = TRUE)
# p = 0.6657
# Not reject!
```

```{r}
# "d13C_VPDB" level in Hare groups
with(test.Hare.d13C, shapiro.test(value[Site == "BAOX"])) # p = 0.2707
with(test.Hare.d13C, shapiro.test(value[Site == "Tlajinga"])) # p = 0.2447

# From the output, the two p-values are greater than the significance level 0.05 
# implying that the distribution of the data are not significantly different 
# from the normal distribution. In other words, we can assume the normality.

t.test(value ~ Site, data = test.Hare.d13C, conf.level = 0.99, var.equal = TRUE)
# p = 0.3999
# Not reject!
```


### "d15N_air" level

```{r}
# "d15N_air" level in turkey groups
with(test.turkey.d15N, shapiro.test(value[Site == "BAOX"])) # p = 0.7717
with(test.turkey.d15N, shapiro.test(value[Site == "Tlajinga"])) # p = 0.4532

# From the output, the two p-values are greater than the significance level 0.05 
# implying that the distribution of the data are not significantly different 
# from the normal distribution. In other words, we can assume the normality.

t.test(value ~ Site, data = test.turkey.d15N, conf.level = 0.99, var.equal = TRUE)
# p = 0.2313
# Not reject!
```


```{r}
# "d15N_air" level in Cottontail groups
with(test.Cottontail.d15N, shapiro.test(value[Site == "BAOX"])) # p = 0.09437
with(test.Cottontail.d15N, shapiro.test(value[Site == "Tlajinga"])) # p = 0.2703

# From the output, the two p-values are greater than the significance level 0.05 
# implying that the distribution of the data are not significantly different 
#from the normal distribution. In other words, we can assume the normality.
t.test(value ~ Site, data = test.Cottontail.d15N, conf.level = 0.99, var.equal = TRUE)
# p = 0.0321
# Not Reject!
```


```{r}
# "d15N_air" level in Deer groups
with(test.Deer.d15N, shapiro.test(value[Site == "BAOX"])) # p = 0.5592
with(test.Deer.d15N, shapiro.test(value[Site == "Tlajinga"])) # p = 0.7696

# From the output, the two p-values are greater than the significance level 0.05 
# implying that the distribution of the data are not significantly different 
# from the normal distribution. In other words, we can assume the normality.
t.test(value ~ Site, data = test.Deer.d15N, conf.level = 0.99, var.equal = TRUE)
# p = 0.3106
# Not reject!
```


```{r}
# "d15N_air" level in Hare groups
with(test.Hare.d15N, shapiro.test(value[Site == "BAOX"])) # p = 0.3232
with(test.Hare.d15N, shapiro.test(value[Site == "Tlajinga"])) # p = 0.4432

# From the output, the two p-values are greater than the significance level 0.05 
# implying that the distribution of the data are not significantly different 
# from the normal distribution. In other words, we can assume the normality.

t.test(value ~ Site, data = test.Hare.d15N, conf.level = 0.99, var.equal = TRUE)
# p = 0.4013
# Not reject!
```


### "ap_13C_VPDB" level

```{r}
# "ap_13C_VPDB" level in turkey groups
with(test.turkey.ap13C, shapiro.test(value[Site == "BAOX"])) # p = 0.5876
with(test.turkey.ap13C, shapiro.test(value[Site == "Tlajinga"])) # p = 0.3992

# From the output, the two p-values are greater than the significance level 0.05 implying that the distribution of the data are not significantly different from the normal distribution. In other words, we can assume the normality.

t.test(value ~ Site, data = test.turkey.ap13C, conf.level = 0.99, var.equal = TRUE)
# p = 0.2241
# Not reject!
```

```{r}
# "ap_13C_VPDB" level in Cottontail groups
with(test.Cottontail.ap13C, shapiro.test(value[Site == "BAOX"])) # p = 0.1675
with(test.Cottontail.ap13C, shapiro.test(value[Site == "Tlajinga"])) # p = 0.4795

# From the output, the two p-values are greater than the significance level 0.05 
# implying that the distribution of the data are not significantly different 
# from the normal distribution. In other words, we can assume the normality.
t.test(value ~ Site, data = test.Cottontail.ap13C, conf.level = 0.99, var.equal = TRUE)
# p = 0.6955
# not Reject!
```


```{r}
# "ap_13C_VPDB" level in Deer groups
with(test.Deer.ap13C, shapiro.test(value[Site == "BAOX"])) # p = 0.54
with(test.Deer.ap13C, shapiro.test(value[Site == "Tlajinga"])) # p = 0.3121

# From the output, the two p-values are greater than the significance level 0.05 
# implying that the distribution of the data are not significantly different 
# from the normal distribution. In other words, we can assume the normality.
t.test(value ~ Site, data = test.Deer.ap13C, conf.level = 0.99, var.equal = TRUE)
# p = 0.4406
# Not reject!
```


```{r}
# "ap_13C_VPDB" level in Hare groups
with(test.Hare.ap13C, shapiro.test(value[Site == "BAOX"])) # p = 0.7399
with(test.Hare.ap13C, shapiro.test(value[Site == "Tlajinga"])) # p = 0.2754

# From the output, the two p-values are greater than the significance level 0.05 
# implying that the distribution of the data are not significantly different 
# from the normal distribution. In other words, we can assume the normality.

t.test(value ~ Site, data = test.Hare.ap13C, conf.level = 0.99, var.equal = TRUE)
# p = 0.8815
# Not reject!
```



### Mann Whitney U Test with R Package
Mann-Whitney U Test for deer.

```{r,echo=FALSE,warning=FALSE}
data_deer_dc<-data_deer[which(data_deer$variable=="d13C_VPDB"),]
wilcox.test(value~Site,conf.level = 0.99,data=data_deer_dc)

data_deer_apc<-data_deer[which(data_deer$variable=="ap_13C_VPDB"),] %>% na.omit(data_deer)
wilcox.test(value~Site,conf.level = 0.99,data=data_deer_apc)

data_deer_n<-data_deer[which(data_deer$variable=="d15N_air"),]
wilcox.test(value~Site,conf.level = 0.99,data=data_deer_n)
```

Mann-Whitney U Test for Cottontail.

```{r,echo=FALSE,warning=FALSE}
data_cott_dc<-data_Cottontail[which(data_Cottontail$variable=="d13C_VPDB"),]
wilcox.test(value~Site,conf.level = 0.99,data=data_cott_dc)

data_cott_apc<-data_Cottontail[which(data_Cottontail$variable=="ap_13C_VPDB"),] 
wilcox.test(value~Site,conf.level = 0.99,data=data_cott_apc)

data_cott_n<-data_Cottontail[which(data_Cottontail$variable=="d15N_air"),]%>% na.omit(data_Cottontail)
wilcox.test(value~Site,conf.level = 0.99,data=data_cott_n)
```

Mann-Whitney U Test for Hare.

```{r,echo=FALSE,warning=FALSE}
data_hare_dc<-data_Hare[which(data_Hare$variable=="d13C_VPDB"),]
wilcox.test(value~Site,conf.level = 0.99,data=data_hare_dc)

data_hare_apc<-data_Hare[which(data_Hare$variable=="ap_13C_VPDB"),] 
wilcox.test(value~Site,conf.level = 0.99,data=data_hare_apc)

data_hare_n<-data_Hare[which(data_Hare$variable=="d15N_air"),]
wilcox.test(value~Site,conf.level = 0.99,data=data_hare_n)
```

Mann-Whitney U Test for Turkey.

```{r,echo=FALSE,warning=FALSE}
data_turkey_dc<-data_Turkey[which(data_Turkey$variable=="d13C_VPDB"),]
wilcox.test(value~Site,conf.level = 0.99,data=data_turkey_dc)

data_turkey_apc<-data_Turkey[which(data_Turkey$variable=="ap_13C_VPDB"),] 
wilcox.test(value~Site,conf.level = 0.99,data=data_turkey_apc)

data_turkey_n<-data_Turkey[which(data_Turkey$variable=="d15N_air"),]
wilcox.test(value~Site,conf.level = 0.99,data=data_turkey_n)
```


### Check Mann-Whitney U Test with theory
```{r,include=FALSE}
Utable<-read.xlsx("Mann-Whitney_Table_0.01.xlsx")

Utest<-function(set1,set2){
  l1<-length(set1)
  l2<-length(set2)
  set<-c(set1,set2)
  set<-rbind(set,c(rep(1,l1),rep(2,l2)))
  rset<-rank(set[1,])
  R1<-sum(rset[1:l1])
  R2<-sum(rset[(l1+1):(l1+l2)])
  U1<-l1*l2+l1*(l1+1)/2-R1
  U2<-l1*l2+l2*(l2+1)/2-R2
  #print(min(U1,U2))
  #print(Utable[l1,l2])
  min(U1,U2)<Utable[l1,l2]
}
```

Mann-Whitney U Test for deer.

```{r,echo=FALSE,warning=FALSE}
setA<-data_deer_dc[which(data_deer_dc$Site=="BAOX"),]
setB<-data_deer_dc[which(data_deer_dc$Site=="Tlajinga"),]
print("d13C_VPDB:")
Utest(setA$value,setB$value)


setA<-data_deer_apc[which(data_deer_apc$Site=="BAOX"),]
setB<-data_deer_apc[which(data_deer_apc$Site=="Tlajinga"),]
print("d15N_air:")
Utest(setA$value,setB$value)

setA<-data_deer_n[which(data_deer_n$Site=="BAOX"),]
setB<-data_deer_n[which(data_deer_n$Site=="Tlajinga"),]
print("ap_13C_VPDB:")
Utest(setA$value,setB$value)
```

Mann-Whitney U Test for Cottontail.

```{r,echo=FALSE,warning=FALSE}
setA<-data_cott_dc[which(data_cott_dc$Site=="BAOX"),]
setB<-data_cott_dc[which(data_cott_dc$Site=="Tlajinga"),]
print("d13C_VPDB:")
Utest(setA$value,setB$value)

setA<-data_cott_apc[which(data_cott_apc$Site=="BAOX"),]
setB<-data_cott_apc[which(data_cott_apc$Site=="Tlajinga"),]
print("d15N_air:")
Utest(setA$value,setB$value)

setA<-data_cott_n[which(data_cott_n$Site=="BAOX"),]
setB<-data_cott_n[which(data_cott_n$Site=="Tlajinga"),]
print("ap_13C_VPDB:")
Utest(setA$value,setB$value)
```

Mann-Whitney U Test for Hare.

```{r,echo=FALSE,warning=FALSE}
setA<-data_hare_dc[which(data_hare_dc$Site=="BAOX"),]
setB<-data_hare_dc[which(data_hare_dc$Site=="Tlajinga"),]
print("d13C_VPDB:")
Utest(setA$value,setB$value)

setA<-data_hare_apc[which(data_hare_apc$Site=="BAOX"),]
setB<-data_hare_apc[which(data_hare_apc$Site=="Tlajinga"),]
print("d15N_air:")
Utest(setA$value,setB$value)

setA<-data_hare_n[which(data_hare_n$Site=="BAOX"),]
setB<-data_hare_n[which(data_hare_n$Site=="Tlajinga"),]
print("ap_13C_VPDB:")
Utest(setA$value,setB$value)

```

Mann-Whitney U Test for Turkey.

```{r,echo=FALSE,warning=FALSE}
setA<-data_turkey_dc[which(data_turkey_dc$Site=="BAOX"),]
setB<-data_turkey_dc[which(data_turkey_dc$Site=="Tlajinga"),]
print("d13C_VPDB:")
Utest(setA$value,setB$value)

setA<-data_turkey_apc[which(data_turkey_apc$Site=="BAOX"),]
setB<-data_turkey_apc[which(data_turkey_apc$Site=="Tlajinga"),]
print("d15N_air:")
Utest(setA$value,setB$value)

setA<-data_turkey_n[which(data_turkey_n$Site=="BAOX"),]
setB<-data_turkey_n[which(data_turkey_n$Site=="Tlajinga"),]
print("ap_13C_VPDB:")
Utest(setA$value,setB$value)
```

## Resource

**multiple testing**
  
Megan Goldman, 2008, [Statistics for Bioinformatics ](https://www.stat.berkeley.edu/~mgoldman/Section0402.pdf)

**Mann-Whitney U Test**
  
[Mann-Whitney U Test Theory](https://www.statology.org/mann-whitney-u-test/)

[Mann-Whitney U Test table](https://www.statology.org/mann-whitney-u-table/)
